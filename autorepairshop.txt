// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.7.0 <0.9.0;

contract Autorepairshop {

    struct Car {
        string mark;
        string color;
    }

    struct Request {
        uint carId;
        string color;
        bool status;
        uint price;
        bool confirmStatus;
    }

    mapping(address => Car[]) cars;
    mapping(address => Request[]) requests;


    address admin;
    constructor() {
        admin = msg.sender;
    }

    function addCar (address owner, string memory mark, string memory color) public {
        require(msg.sender == admin, "You dont have permission!");
        cars[owner].push(Car(mark, color));
    }

    function createRequire (uint carId, string memory color) public {
        requests[msg.sender].push(Request(carId, color, true, 0, false));
    }

    function masterCarRating (address owner, uint requestId, uint price) public {
        require(msg.sender == admin, "You dont have permission!");
        require(requests[owner][requestId].price == 0, "This car has already been rated.");
        requests[owner][requestId].price = price;
    }

    function customerConfirmation (uint requestId) public payable {
        require(msg.value == requests[msg.sender][requestId].price, "You don't have enough money");
        requests[msg.sender][requestId].confirmStatus = true;
    }

    function masterCarRecolor (address owner, uint requestId) public {
        require(msg.sender == admin, "You dont have permission!");
        require(requests[owner][requestId].confirmStatus = true, "The customer did not confirm this operation.");
        require(requests[owner][requestId].status == true, "This request has already been completed.");
        cars[owner][requests[owner][requestId].carId].color = requests[owner][requestId].color;
        requests[owner][requestId].status = false;
    }

    function showRequests (address owner) public view returns (Request[] memory) {
        return requests[owner];
    }

    function showCars (address owner) public view returns(Car[] memory) {
        return cars[owner];
    }

}