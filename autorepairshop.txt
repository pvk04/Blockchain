// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.7.0 <0.9.0;

contract Autorepairshop {

    struct Car {
        string mark;
        string color;
    }

    struct Request {
        address owner;
        uint carId;
        string color;
        bool status;
        uint price;
        bool confirmStatus;
    }

    mapping(address => Car[]) cars;
    Request[] requests;
    

    address admin;
    constructor() {
        admin = msg.sender;
    }

    function addCar (address owner, string memory mark, string memory color) public {
        require(msg.sender == admin, "You dont have permission!");
        cars[owner].push(Car(mark, color));
    }

    function createRequire (uint carId, string memory color) public {
        requests.push(Request(msg.sender, carId, color, true, 0, false));
    }

    function masterCarRating (uint requestId, uint price) public {
        require(msg.sender == admin, "You dont have permission!");
        require(requests[requestId].price == 0, "This car has already been rated.");
        requests[requestId].price = price;
    }

    function customerConfirmation (uint requestId) public payable {
        require(msg.value == requests[requestId].price, "You don't have enough money");
        require(msg.sender == requests[requestId].owner, "You did not make this request");
        requests[requestId].confirmStatus = true;
    }

    function masterCarRecolor (uint requestId) public {
        require(msg.sender == admin, "You dont have permission!");
        require(requests[requestId].confirmStatus = true, "The customer did not confirm this operation.");
        require(requests[requestId].status == true, "This request has already been completed.");
        cars[requests[requestId].owner][requests[requestId].carId].color = requests[requestId].color;
        requests[requestId].status = false;
    }

    function showRequests () public view returns (Request[] memory) {
        return requests;
    }

    function showCars (address owner) public view returns(Car[] memory) {
        return cars[owner];
    }

}